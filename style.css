/* --- CSS Variables and Base Styles --- */
:root {
    --bg-color: #FFFDF7;
    --text-color: #333;
    --primary-color: #B11226;
    --accent-color: #F8B4C4;
    --envelope-color: #f7d9e0;
    --leaf-color: #4CAF50; /* A brighter green */
    --font-heading: 'Great Vibes', cursive;
    --font-body: 'Inter', sans-serif;
    --font-handwriting: 'Dancing Script', cursive; /* New handwriting font */
    --shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
}

* { box-sizing: border-box; margin: 0; padding: 0; }

html, body { height: 100%; overflow: hidden; }

body {
    font-family: var(--font-body);
    background-color: var(--bg-color);
    color: var(--text-color);
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 1rem;
}

/* --- Main Layout & Screen Transitions --- */
main { position: relative; width: 100%; max-width: 500px; height: 95vh; max-height: 850px; }

.screen {
    position: absolute;
    inset: 0;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    box-shadow: var(--shadow);
    border: 1px solid rgba(255, 255, 255, 0.9);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    opacity: 0;
    transform: translateY(50px) scale(0.95);
    transition: opacity 500ms ease-out, transform 500ms ease-out;
    pointer-events: none;
}

#wishes-screen { display: flex; justify-content: center; align-items: center; }
.screen.active { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
.screen:not(.active) { transform: translateY(-50px) scale(0.95); }

/* --- Welcome Screen Specifics --- */
.content-wrapper-welcome { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; }
.title { font-family: var(--font-heading); font-size: clamp(3rem, 10vw, 4.5rem); color: var(--primary-color); font-weight: normal; margin-bottom: 0.5rem; }
.subtitle { font-weight: 500; font-size: 1.1rem; color: var(--primary-color); opacity: 0.9; }
.description { margin: 1.5rem 0; font-size: 1rem; line-height: 1.6; }

/* --- Form Elements & Buttons --- */
#name-form { margin-top: 2rem; display: flex; flex-direction: column; gap: 1rem; }
#name-input { width: 100%; padding: 1rem; border: 1px solid #ddd; border-radius: 12px; font-size: 1rem; font-family: var(--font-body); transition: border-color 0.3s, box-shadow 0.3s; }
#name-input:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(248, 180, 196, 0.5); }
#name-input.error { animation: shake 0.5s ease-in-out; border-color: var(--primary-color); }
.btn { padding: 1rem 1.5rem; border: none; border-radius: 12px; font-size: 1rem; font-weight: 500; cursor: pointer; background-color: var(--primary-color); color: white; transition: transform 0.2s, background-color 0.2s; font-family: var(--font-body); }
.btn:hover, .btn:focus { transform: translateY(-2px); background-color: #9a0f20; outline: none; }

/* --- Envelope Styles --- */
#envelope-container { perspective: 1000px; z-index: 20; position: absolute; }
.envelope { position: relative; width: 320px; height: 210px; cursor: pointer; transform-style: preserve-3d; transition: transform 0.5s, opacity 0.5s 0.5s; }
.envelope.open { opacity: 0; transform: scale(0.8); pointer-events: none; }
.envelope-body { position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; background-color: var(--envelope-color); z-index: 1; border-radius: 0 0 10px 10px; }
.envelope-body::before, .envelope-body::after { content: ''; position: absolute; bottom: 0; height: 100%; width: 50%; background-color: var(--envelope-color); z-index: 3; }
.envelope-body::before { left: 0; transform-origin: left bottom; transform: skewY(20deg); border-radius: 0 0 0 10px; }
.envelope-body::after { right: 0; transform-origin: right bottom; transform: skewY(-20deg); border-radius: 0 0 10px 0; }
.envelope-flap.top { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--accent-color); z-index: 4; transform-origin: top; transition: transform 0.5s ease-in-out; clip-path: polygon(0 0, 100% 0, 50% 60%); }
.envelope-prompt { position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%); z-index: 5; color: var(--primary-color); font-family: var(--font-heading); font-size: 2rem; opacity: 1; transition: opacity 0.3s; pointer-events: none; }
.envelope.open .envelope-flap.top { transform: rotateX(180deg); }
.envelope.open .envelope-prompt { opacity: 0; }

/* --- Wish Content on Background --- */
#wish-content-container {
    position: absolute;
    width: 90%;
    max-width: 450px;
    height: auto;
    z-index: 30;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    pointer-events: none;
}
#wish-content-container.visible {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
}
.greeting-text { font-family: var(--font-handwriting); font-size: 2.2rem; font-weight: 500; color: #5c3c3c; margin-bottom: 1.5rem; text-shadow: 1px 1px 3px rgba(255,255,255,0.7); }
.wish-letter { font-family: var(--font-handwriting); font-size: 1.5rem; line-height: 1.2; margin-bottom: 1.5rem; text-shadow: 1px 1px 3px rgba(255,255,255,0.7); min-height: 150px; color: #333; }
.signature-text { font-family: var(--font-heading); font-size: 2rem; color: var(--primary-color); margin-bottom: 2rem; text-shadow: 1px 1px 3px rgba(255,255,255,0.5); opacity: 0; transition: opacity 0.5s ease-in-out; }
.signature-text.visible { opacity: 1; }

/* --- Corner Controls & Background Decorations --- */
#fireworks-canvas { position: absolute; inset: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
.controls-corner { position: absolute; bottom: 1rem; left: 1.5rem; z-index: 40; }
.bottom-right-corner { position: absolute; bottom: -30px; right: 0; z-index: 35; display: flex; flex-direction: column; align-items: center; }
.coder-credit { font-size: 0.8rem; color: #aaa; }

/* --- Art Bouquet --- */
#bouquet-container {
    width: 250px;
    height: 200px;
    opacity: 0;
    transition: opacity 0.6s ease-out 1s;
}
#bouquet-container.visible { opacity: 1; }
.bouquet-svg { width: 100%; height: 100%; overflow: visible; }
.bouquet-svg .rose { transform-origin: 0px 80px; } /* transform from the base of the stem */
.bouquet-svg .stem { stroke: var(--leaf-color); stroke-width: 2px; fill: none; }
.bouquet-svg .leaf { fill: var(--leaf-color); opacity: 0.8; stroke: #255d28; stroke-width: 0.5px; }
.bouquet-svg .petal { fill: #f8bbd0; transform-origin: 0 0; }
.bouquet-svg .pistil { fill: #ffeb3b; }
.bouquet-svg .ribbon { stroke: var(--primary-color); stroke-width: 2px; fill: none; opacity: 0.7; }
/* Petal arrangement for a fuller look */
.petal-1 { transform: rotate(0deg) scale(1); }
.petal-2 { transform: rotate(60deg) scale(1); }
.petal-3 { transform: rotate(120deg) scale(1); }
.petal-4 { transform: rotate(180deg) scale(0.9); }
.petal-5 { transform: rotate(240deg) scale(0.95); }
.petal-6 { transform: rotate(300deg) scale(0.9); }

/* Bouquet arrangement and animation */
.rose-1 { transform: translate(120px, 60px) rotate(10deg); animation: sway 8s ease-in-out infinite 0.2s; }
.rose-2 { transform: translate(80px, 65px) rotate(-15deg); animation: sway 7s ease-in-out infinite; }
.rose-3 { transform: translate(160px, 65px) rotate(25deg); animation: sway 9s ease-in-out infinite 0.4s; }
.rose-4 { transform: translate(100px, 40px) rotate(-5deg); animation: sway 6s ease-in-out infinite 0.1s; }
.rose-5 { transform: translate(140px, 40px) rotate(15deg); animation: sway 8s ease-in-out infinite 0.3s; }
.rose-6 { transform: translate(120px, 20px) rotate(0deg); animation: sway 7s ease-in-out infinite 0.5s; }

/* --- Music Player & Tooltip --- */
.music-player-container { position: relative; }
#music-player { display: flex; align-items: flex-end; gap: 0.5rem; }
#music-disc { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid #fff; box-shadow: 0 0 10px rgba(0,0,0,0.2); }
#music-disc.playing { animation: spin 4s linear infinite; }
.music-controls-stack { display: flex; flex-direction: column; gap: 0.3rem; align-items: flex-start; }
#music-toggle { background: rgba(255, 255, 255, 0.5); border: 1px solid #eee; padding: 0.5rem; border-radius: 8px; cursor: pointer; color: #555; display: flex; align-items: center; justify-content: center; }
#music-toggle.active { background-color: var(--accent-color); color: var(--primary-color); }
#song-list { display: flex; gap: 0.3rem; background: rgba(255, 255, 255, 0.5); padding: 0.3rem; border-radius: 8px; }
.song-item { border: none; background: transparent; color: #555; padding: 0.2rem 0.5rem; font-size: 0.7rem; border-radius: 5px; cursor: pointer; transition: background-color 0.2s, color 0.2s; }
.song-item.active-song { background-color: var(--primary-color); color: white; }
.tooltip { position: absolute; bottom: 25px; left: 65px; width: 150px; background-color: var(--primary-color); color: white; padding: 0.8rem; border-radius: 12px; font-size: 0.8rem; text-align: left; line-height: 1.4; z-index: 40; box-shadow: 0 4px 15px rgba(0,0,0,0.2); opacity: 0; transform: translateY(10px); animation: fadeInTooltip 0.5s 1s ease-out forwards, bounceTooltip 2s 1.5s ease-in-out infinite; pointer-events: none; }
.tooltip.hidden { display: none; }
.tooltip::after { content: ''; position: absolute; bottom: 15px; left: -10px; border-width: 10px; border-style: solid; border-color: transparent var(--primary-color) transparent transparent; }

/* --- Animations --- */
@keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); } 20%, 40%, 60%, 80% { transform: translateX(5px); } }
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
@keyframes fadeInTooltip { to { opacity: 1; transform: translateY(0); } }
@keyframes bounceTooltip { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
@keyframes sway { 
    0%, 100% { transform: translate(var(--tx, 0), var(--ty, 0)) rotate(var(--r-start, 0deg)); }
    50% { transform: translate(var(--tx, 0), var(--ty, 0)) rotate(var(--r-end, 0deg)); }
}

.rose-1 { --tx: 120px; --ty: 60px; --r-start: 10deg; --r-end: 12deg; animation: sway 8s ease-in-out infinite 0.2s; }
.rose-2 { --tx: 80px; --ty: 65px; --r-start: -15deg; --r-end: -13deg; animation: sway 7s ease-in-out infinite; }
.rose-3 { --tx: 160px; --ty: 65px; --r-start: 25deg; --r-end: 27deg; animation: sway 9s ease-in-out infinite 0.4s; }
.rose-4 { --tx: 100px; --ty: 40px; --r-start: -5deg; --r-end: -3deg; animation: sway 6s ease-in-out infinite 0.1s; }
.rose-5 { --tx: 140px; --ty: 40px; --r-start: 15deg; --r-end: 17deg; animation: sway 8s ease-in-out infinite 0.3s; }
.rose-6 { --tx: 120px; --ty: 20px; --r-start: 0deg; --r-end: 2deg; animation: sway 7s ease-in-out infinite 0.5s; }

